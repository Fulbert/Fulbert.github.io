import{_ as ye}from"./HighlightBlock.vue_vue_type_style_index_0_lang-qbPPhopM.js";import{m as me,u as Te,h as m,aa as Se,y as pe,g as qe,A as Ke,r as B,aP as Le,c as z,w as ce,G as Pe,aQ as $e,ab as Ee,az as Z,aR as ze,aq as ue,H as Be,aS as Ae,aT as fe,d as Ne,k as M,l as K,Y as N,f as L,_ as Qe,a3 as S,a6 as R,ae as J,i as Fe,$ as D,a7 as Ve,a5 as he,Q as He,Z as Oe,aj as le,a4 as ne}from"./index-CkHtFk-G.js";import{Q as Ue}from"./QSelect-TTgsxVfg.js";import{a as ve,Q as je}from"./QBadge-CtBl5-Gm.js";import{u as De}from"./usePlcSiemensJsonRpc-nr3Bo0ZE.js";import"./QItem-D4n1PNfn.js";import"./QItemLabel-Cq4i02Nq.js";import"./selection-DT_R9Vgf.js";import"./format-BvkBI9bc.js";import"./index-BAU4s81U.js";import"./axios-DjX7m9jH.js";import"./app-store-BeK8FA_5.js";import"./index-BF-LnGoJ.js";const Me=me({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(a,{slots:w,emit:b}){let C=!1,v,k,g=null,x=null,f,p;function q(){v?.(),v=null,C=!1,g!==null&&(clearTimeout(g),g=null),x!==null&&(clearTimeout(x),x=null),k?.removeEventListener("transitionend",f),f=null}function A(s,T,o){T!==void 0&&(s.style.height=`${T}px`),s.style.transition=`height ${a.duration}ms cubic-bezier(.25, .8, .50, 1)`,C=!0,v=o}function Q(s,T){s.style.overflowY=null,s.style.height=null,s.style.transition=null,q(),T!==p&&b(T)}function F(s,T){let o=0;k=s,C===!0?(q(),o=s.offsetHeight===s.scrollHeight?0:void 0):(p="hide",s.style.overflowY="hidden"),A(s,o,T),g=setTimeout(()=>{g=null,s.style.height=`${s.scrollHeight}px`,f=d=>{x=null,(Object(d)!==d||d.target===s)&&Q(s,"show")},s.addEventListener("transitionend",f),x=setTimeout(f,a.duration*1.1)},100)}function P(s,T){let o;k=s,C===!0?q():(p="show",s.style.overflowY="hidden",o=s.scrollHeight),A(s,o,T),g=setTimeout(()=>{g=null,s.style.height=0,f=d=>{x=null,(Object(d)!==d||d.target===s)&&Q(s,"hide")},s.addEventListener("transitionend",f),x=setTimeout(f,a.duration*1.1)},100)}return Te(()=>{C===!0&&q()}),()=>m(Se,{css:!1,appear:a.appear,onEnter:F,onLeave:P},w.default)}}),Re=["none","strict","leaf","leaf-filtered"],Ie=me({name:"QTree",props:{...pe,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:a=>Re.includes(a)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:{},noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(a,{slots:w,emit:b}){const{proxy:C}=qe(),{$q:v}=C,k=Ke(a,v),g=B({}),x=B(a.ticked||[]),f=B(a.expanded||[]);let p={};Le(()=>{p={}});const q=z(()=>`q-tree q-tree--${a.dense===!0?"dense":"standard"}`+(a.noConnectors===!0?" q-tree--no-connectors":"")+(k.value===!0?" q-tree--dark":"")+(a.color!==void 0?` text-${a.color}`:"")),A=z(()=>a.selected!==void 0),Q=z(()=>a.icon||v.iconSet.tree.icon),F=z(()=>a.controlColor||a.color),P=z(()=>a.textColor!==void 0?` text-${a.textColor}`:""),s=z(()=>{const t=a.selectedColor||a.color;return t?` text-${t}`:""}),T=z(()=>a.filterMethod!==void 0?a.filterMethod:(t,l)=>{const e=l.toLowerCase();return t[a.labelKey]&&t[a.labelKey].toLowerCase().indexOf(e)!==-1}),o=z(()=>{const t={},l=(e,r)=>{const n=e.tickStrategy||(r?r.tickStrategy:a.tickStrategy),u=e[a.nodeKey],h=e[a.childrenKey]&&Array.isArray(e[a.childrenKey])&&e[a.childrenKey].length!==0,U=e.disabled!==!0&&A.value===!0&&e.selectable!==!1,_=e.disabled!==!0&&e.expandable!==!1,Ce=n!=="none",G=n==="strict",de=n==="leaf-filtered",te=n==="leaf"||n==="leaf-filtered";let ae=e.disabled!==!0&&e.tickable!==!1;te===!0&&ae===!0&&r&&r.tickable!==!0&&(ae=!1);let j=e.lazy;j===!0&&g.value[u]!==void 0&&Array.isArray(e[a.childrenKey])===!0&&(j=g.value[u]);const c={key:u,parent:r,isParent:h,lazy:j,disabled:e.disabled,link:e.disabled!==!0&&(U===!0||_===!0&&(h===!0||j===!0)),children:[],matchesFilter:a.filter?T.value(e,a.filter):!0,selected:u===a.selected&&U===!0,selectable:U,expanded:h===!0?f.value.includes(u):!1,expandable:_,noTick:e.noTick===!0||G!==!0&&j&&j!=="loaded",tickable:ae,tickStrategy:n,hasTicking:Ce,strictTicking:G,leafFilteredTicking:de,leafTicking:te,ticked:G===!0?x.value.includes(u):h===!0?!1:x.value.includes(u)};if(t[u]=c,h===!0&&(c.children=e[a.childrenKey].map(y=>l(y,c)),a.filter&&(c.matchesFilter!==!0?c.matchesFilter=c.children.some(y=>y.matchesFilter):c.noTick!==!0&&c.disabled!==!0&&c.tickable===!0&&de===!0&&c.children.every(y=>y.matchesFilter!==!0||y.noTick===!0||y.tickable!==!0)===!0&&(c.tickable=!1)),c.matchesFilter===!0&&(c.noTick!==!0&&G!==!0&&c.children.every(y=>y.noTick)===!0&&(c.noTick=!0),te))){if(c.ticked=!1,c.indeterminate=c.children.some(y=>y.indeterminate===!0),c.tickable=c.tickable===!0&&c.children.some(y=>y.tickable),c.indeterminate!==!0){const y=c.children.reduce((se,we)=>we.ticked===!0?se+1:se,0);y===c.children.length?c.ticked=!0:y>0&&(c.indeterminate=!0)}c.indeterminate===!0&&(c.indeterminateNextState=c.children.every(y=>y.tickable!==!0||y.ticked!==!0))}return c};return a.nodes.forEach(e=>l(e,null)),t});ce(()=>a.ticked,t=>{x.value=t}),ce(()=>a.expanded,t=>{f.value=t});function d(t){const l=[].reduce,e=(r,n)=>{if(r||!n)return r;if(Array.isArray(n)===!0)return l.call(Object(n),e,r);if(n[a.nodeKey]===t)return n;if(n[a.childrenKey])return e(null,n[a.childrenKey])};return e(null,a.nodes)}function $(){return x.value.map(t=>d(t))}function i(){return f.value.map(t=>d(t))}function E(t){return t&&o.value[t]?o.value[t].expanded:!1}function I(){a.expanded!==void 0?b("update:expanded",[]):f.value=[]}function V(){const t=[],l=e=>{e[a.childrenKey]&&e[a.childrenKey].length!==0&&e.expandable!==!1&&e.disabled!==!0&&(t.push(e[a.nodeKey]),e[a.childrenKey].forEach(l))};a.nodes.forEach(l),a.expanded!==void 0?b("update:expanded",t):f.value=t}function H(t,l,e=d(t),r=o.value[t]){if(r.lazy&&r.lazy!=="loaded"){if(r.lazy==="loading")return;g.value[t]="loading",Array.isArray(e[a.childrenKey])!==!0&&(e[a.childrenKey]=[]),b("lazyLoad",{node:e,key:t,done:n=>{g.value[t]="loaded",e[a.childrenKey]=Array.isArray(n)===!0?n:[],Pe(()=>{o.value[t]?.isParent===!0&&W(t,!0)})},fail:()=>{delete g.value[t],e[a.childrenKey].length===0&&delete e[a.childrenKey]}})}else r.isParent===!0&&r.expandable===!0&&W(t,l)}function W(t,l){let e=f.value;const r=a.expanded!==void 0;if(r===!0&&(e=e.slice()),l){if(a.accordion&&o.value[t]){const n=[];o.value[t].parent?o.value[t].parent.children.forEach(u=>{u.key!==t&&u.expandable===!0&&n.push(u.key)}):a.nodes.forEach(u=>{const h=u[a.nodeKey];h!==t&&n.push(h)}),n.length!==0&&(e=e.filter(u=>n.includes(u)===!1))}e=e.concat([t]).filter((n,u,h)=>h.indexOf(n)===u)}else e=e.filter(n=>n!==t);r===!0?b("update:expanded",e):f.value=e}function Y(t){return t&&o.value[t]?o.value[t].ticked:!1}function O(t,l){let e=x.value;const r=a.ticked!==void 0;r===!0&&(e=e.slice()),l?e=e.concat(t).filter((n,u,h)=>h.indexOf(n)===u):e=e.filter(n=>t.includes(n)===!1),r===!0&&b("update:ticked",e)}function X(t,l,e){const r={tree:C,node:t,key:e,color:a.color,dark:k.value};return fe(r,"expanded",()=>l.expanded,n=>{n!==l.expanded&&H(e,n)}),fe(r,"ticked",()=>l.ticked,n=>{n!==l.ticked&&O([e],n)}),r}function ie(t){return(a.filter?t.filter(l=>o.value[l[a.nodeKey]].matchesFilter):t).map(l=>_e(l))}function ge(t){if(t.icon!==void 0)return m(Z,{class:"q-tree__icon q-mr-sm",name:t.icon,color:t.iconColor});const l=t.img||t.avatar;if(l)return m("img",{class:`q-tree__${t.img?"img":"avatar"} q-mr-sm`,src:l})}function be(){b("afterShow")}function ke(){b("afterHide")}function _e(t){const l=t[a.nodeKey],e=o.value[l],r=t.header&&w[`header-${t.header}`]||w["default-header"],n=e.isParent===!0?ie(t[a.childrenKey]):[],u=n.length!==0||e.lazy&&e.lazy!=="loaded";let h=t.body&&w[`body-${t.body}`]||w["default-body"];const U=r!==void 0||h!==void 0?X(t,e,l):null;return h!==void 0&&(h=m("div",{class:"q-tree__node-body relative-position"},[m("div",{class:P.value},[h(U)])])),m("div",{key:l,class:`q-tree__node relative-position q-tree__node--${u===!0?"parent":"child"}`},[m("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(e.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(e.selected===!0?" q-tree__node--selected":"")+(e.disabled===!0?" q-tree__node--disabled":""),tabindex:e.link===!0?0:-1,ariaExpanded:n.length>0?e.expanded:null,role:"treeitem",onClick:_=>{oe(t,e,_)},onKeypress(_){$e(_)!==!0&&(_.keyCode===13?oe(t,e,_,!0):_.keyCode===32&&ee(t,e,_,!0))}},[m("div",{class:"q-focus-helper",tabindex:-1,ref:_=>{p[e.key]=_}}),e.lazy==="loading"?m(Ee,{class:"q-tree__spinner",color:F.value}):u===!0?m(Z,{class:"q-tree__arrow"+(e.expanded===!0?" q-tree__arrow--rotate":""),name:Q.value,onClick(_){ee(t,e,_)}}):null,e.hasTicking===!0&&e.noTick!==!0?m(ze,{class:"q-tree__tickbox",modelValue:e.indeterminate===!0?null:e.ticked,color:F.value,dark:k.value,dense:!0,keepColor:!0,disable:e.tickable!==!0,onKeydown:ue,"onUpdate:modelValue":_=>{xe(e,_)}}):null,m("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(e.selected===!0?s.value:P.value)},[r?r(U):[ge(t),m("div",t[a.labelKey])]])]),u===!0?a.noTransition===!0?e.expanded===!0?m("div",{class:"q-tree__node-collapsible"+P.value,key:`${l}__q`},[h,m("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},n)]):null:m(Me,{duration:a.duration,onShow:be,onHide:ke},()=>Be(m("div",{class:"q-tree__node-collapsible"+P.value,key:`${l}__q`},[h,m("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},n)]),[[Ae,e.expanded]])):h])}function re(t){p[t]?.focus()}function oe(t,l,e,r){r!==!0&&l.selectable!==!1&&re(l.key),A.value&&l.selectable?a.noSelectionUnset===!1?b("update:selected",l.key!==a.selected?l.key:null):l.key!==a.selected&&b("update:selected",l.key===void 0?null:l.key):ee(t,l,e,r),typeof t.handler=="function"&&t.handler(t)}function ee(t,l,e,r){e!==void 0&&ue(e),r!==!0&&l.selectable!==!1&&re(l.key),H(l.key,!l.expanded,t,l)}function xe(t,l){if(t.indeterminate===!0&&(l=t.indeterminateNextState),t.strictTicking)O([t.key],l);else if(t.leafTicking){const e=[],r=n=>{n.isParent?(l!==!0&&n.noTick!==!0&&n.tickable===!0&&e.push(n.key),n.leafTicking===!0&&n.children.forEach(r)):n.noTick!==!0&&n.tickable===!0&&(n.leafFilteredTicking!==!0||n.matchesFilter===!0)&&e.push(n.key)};r(t),O(e,l)}}return a.defaultExpandAll===!0&&V(),Object.assign(C,{getNodeByKey:d,getTickedNodes:$,getExpandedNodes:i,isExpanded:E,collapseAll:I,expandAll:V,setExpanded:H,isTicked:Y,setTicked:O}),()=>{const t=ie(a.nodes);return m("div",{class:q.value,role:"tree"},t.length===0?a.filter?a.noResultsLabel||v.lang.tree.noResults:a.noNodesLabel||v.lang.tree.noNodes:t)}}}),Ye={class:"q-gutter-md"},Ge=["innerHTML"],Je={class:"row items-justified items-center full-width"},Ze={class:"col row"},We={class:"q-ml-sm"},Xe={key:0,class:"row items-center justify-end"},et={key:0},tt={key:2,class:"row justify-evenly"},at=Ne({__name:"PlcTreeComponent",setup(a){const w=B([]),b=B([]),C=B(""),v=B(),k=B(!1),{read:g,browse:x,ip:f,servers:p,error:q}=De(),A=async()=>{k.value=!0,w.value=await s(),k.value=!1},Q=(o,d)=>{const $=d.toLowerCase();return o.path.replaceAll('"',"").toLowerCase().indexOf($)>-1},F=async o=>{try{if(v.value===void 0)throw"Can't open tree";const d=v.value.getNodeByKey(o);d.loading=!0,await T(o),d.loading=!1}catch(d){throw le.create({type:"negative",icon:"error",message:"Can't read value"}),d}},P=async o=>{try{const d=await s(o.node.path);o.done(d)}catch(d){throw o.fail(),le.create({type:"negative",icon:"error",message:"Can't open node"}),d}},s=async(o,d=!0)=>{if(f.value===void 0)return[];const $=[];try{const i=await x(o);if(i===void 0)throw new Error("Browse request returned null");$.push(...i)}catch{le.create({message:"Can't browse PLC datas",type:"negative"})}return $.map(i=>{i.name===void 0&&(i.name="");const E=o===void 0?`"${i.name}"`:`${o}."${i.name}"`,I=E.split(".").length;let V=[];if(i.datatype==="struct"&&i.array_dimensions!==void 0&&i.array_dimensions[0]!==void 0){d&&b.value.push(E);const H=i.array_dimensions[0];V=Array(H.count).fill(0).map((W,Y)=>{const O=Y+(H.start_index||0),X=`${E}[${O}]`;return{label:Y.toString(),expandable:!0,selectable:!1,lazy:!0,path:X,loading:!1,datatype:i.name,depth:I}})}return{...i,label:i.name,expandable:i.has_children||V!==void 0,selectable:!i.has_children,lazy:i.has_children,path:E,loading:!1,children:V,depth:I}})},T=async o=>{if(v.value===void 0)throw new Error("Cannot access tree ref");v.value.getNodeByKey(o).value=await g(o)};return(o,d)=>{const $=ye;return K(),M(Oe,null,{default:N(()=>[L(Qe,null,{default:N(()=>[S("div",Ye,[L(Ue,{options:D(p),label:"Select PLC",modelValue:D(f),"onUpdate:modelValue":[d[0]||(d[0]=i=>Fe(f)?f.value=i:null),A],"option-value":"ip","option-label":"name","emit-value":"","map-options":"",rounded:"",outlined:"",loading:k.value,disable:k.value},{prepend:N(()=>[L(Z,{name:"sym_o_dns"})]),_:1},8,["options","modelValue","loading","disable"]),D(q)!==void 0?(K(),M($,{key:0,type:"danger"},{default:N(()=>[S("span",{innerHTML:D(q)},null,8,Ge)]),_:1})):R("",!0),L(Ve,{modelValue:C.value,"onUpdate:modelValue":d[1]||(d[1]=i=>C.value=i),label:"Search data (ex.: Configuration)",rounded:"",outlined:""},{prepend:N(()=>[L(Z,{name:"sym_o_search"})]),_:1},8,["modelValue"]),D(f)!==void 0&&!k.value?(K(),M(D(Ie),{key:1,"no-transition":"",onLazyLoad:P,expanded:b.value,"onUpdate:expanded":d[2]||(d[2]=i=>b.value=i),nodes:w.value,filter:C.value,"filter-method":Q,"node-key":"path",dense:"","selected-color":"blue","label-key":"label",ref_key:"tree",ref:v},{"default-header":N(i=>[S("div",Je,[S("div",Ze,[S("div",null,[i.node.datatype==="datablock"&&i.node.db_number!==void 0?(K(),M(ve,{key:0,label:`DB${i.node.db_number}`,color:"primary"},null,8,["label"])):(K(),M(ve,{key:1,label:`${i.node.datatype}`,color:"secondary"},null,8,["label"]))]),S("div",We,he(i.node.label),1)]),i.node.selectable?(K(),J("div",Xe,[i.node.value!==void 0?(K(),J("div",et,he(i.node.value),1)):R("",!0),L(He,{icon:i.node.value===void 0?"download":"sync",size:"xs",flat:"",loading:i.node.loading,onClick:E=>F(i.node.path)},null,8,["icon","loading","onClick"])])):R("",!0)])]),_:1},8,["expanded","nodes","filter"])):R("",!0),k.value?(K(),J("div",tt,[S("div",null,[L(je,{indeterminate:"",size:"100px",thickness:.2,color:"primary","track-color":"grey-8",class:"q-ma-md"})])])):R("",!0)])]),_:1})]),_:1})}}}),lt={class:"markdown-body"},gt="PLC datas visualization",bt="This procedure helps to check data handled by PLCs (DPU and machine)",kt="precision_manufacturing",_t=["mmd","machine","plc","automation","data","visualization"],xt={__name:"PlcLiveData",setup(a,{expose:w}){return w({frontmatter:{title:"PLC datas visualization",description:"This procedure helps to check data handled by PLCs (DPU and machine)",icon:"precision_manufacturing",tags:["mmd","machine","plc","automation","data","visualization"]}}),(C,v)=>{const k=ye,g=at;return K(),J("div",lt,[L(k,{type:"warning"},{default:N(()=>v[0]||(v[0]=[ne("This page provide a tool to browse through the data shared by the PLC. This is an expert view that is not meant to be used in regular procedures. Procedures would pin point to the right variable if needed, eventually with the possibility to modify a value (ex. Stop distance)")])),_:1}),v[1]||(v[1]=S("ol",null,[S("li",null,"Select a PLC to browse."),S("li",null,"Use a filter (ex. Configuration)."),S("li",null,"Browse to the desired done."),S("li",null,[ne("Click "),S("code",null,"↓"),ne(" to read the value of a node.")])],-1)),L(g)])}}};export{xt as default,bt as description,kt as icon,_t as tags,gt as title};
